select country, CAST(avg(x.mw) AS numeric(10,2)) as mwg from (
   select country,(power(bore,3)/2) as mw,name from classes c
   join ships s on c.class = s.class
   union 
   (select distinct country,(power(bore,3)/2) as mw,ship from classes c
   join outcomes o on c.class= o.ship
   where o.ship not in(select name  from ships))
       
) x 
group by country